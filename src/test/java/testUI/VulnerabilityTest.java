package testUI;

import config.EnvironmentConfig;
import config.OwaspConfig;
import factoryRequest.FactoryRequest;
import factoryRequest.ResponseInformation;
import org.json.JSONObject;
import org.junit.jupiter.api.Test;

public class VulnerabilityTest {

    private static final String GET ="get";
    private static final String SCAN="scan";
    private static final String STATUS="status";

    @Test
    public void verifyVulnerabilityTesting() throws InterruptedException {
        ResponseInformation responseInformation = new ResponseInformation();
        responseInformation=FactoryRequest.make(GET).send( OwaspConfig.START_SCANNING+ EnvironmentConfig.host,"");

        String idScan= new JSONObject(responseInformation.getBody()).get(SCAN).toString();


        responseInformation=FactoryRequest.make(GET).send(OwaspConfig.CHECK_STATUS+idScan,"");
        String status= new JSONObject(responseInformation.getBody()).get(STATUS).toString();

        while (!status.equals("100")){
            Thread.sleep(10000);
            responseInformation=FactoryRequest.make(GET).send(OwaspConfig.CHECK_STATUS+idScan,"");
            status= new JSONObject(responseInformation.getBody()).get(STATUS).toString();
            System.out.println("Status Progress : ["+status+"%]....");
            responseInformation=FactoryRequest.make(GET).send(OwaspConfig.READ_ALERTS+ EnvironmentConfig.host,"");

        }
        responseInformation=FactoryRequest.make(GET).send(OwaspConfig.READ_LIST_ATTACK+idScan,"");
        responseInformation=FactoryRequest.make(GET).send(OwaspConfig.GENERATE_REPORT2,"");
        responseInformation=FactoryRequest.make(GET).send(OwaspConfig.GENERATE_REPORT,"");

    }
}


